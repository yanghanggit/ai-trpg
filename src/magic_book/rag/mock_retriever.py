"""
Mock æ–‡æ¡£æ£€ç´¢å™¨å®žçŽ°

æœ¬æ¨¡å—æä¾›ç”¨äºŽæµ‹è¯•çš„ Mock æ–‡æ¡£æ£€ç´¢å™¨å®žçŽ°ã€‚

MockDocumentRetriever è¿”å›žé¢„å®šä¹‰çš„æ¨¡æ‹Ÿæ–‡æ¡£å’Œç›¸ä¼¼åº¦åˆ†æ•°ï¼Œ
ç”¨äºŽæµ‹è¯• RAG å·¥ä½œæµï¼Œæ— éœ€ä¾èµ–çœŸå®žçš„å‘é‡æ•°æ®åº“ã€‚
"""

from typing import List
from loguru import logger
from ..deepseek import DocumentRetriever


class MockDocumentRetriever(DocumentRetriever):
    """
    Mock æ–‡æ¡£æ£€ç´¢å™¨å®žçŽ°

    ç”¨äºŽæµ‹è¯• RAG å·¥ä½œæµï¼Œè¿”å›žé¢„å®šä¹‰çš„æ¨¡æ‹Ÿæ–‡æ¡£å’Œç›¸ä¼¼åº¦åˆ†æ•°ã€‚
    åœ¨çœŸå®žåœºæ™¯ä¸­ï¼Œåº”è¯¥ä½¿ç”¨ ChromaDBRetriever æˆ–å…¶ä»–å®žé™…çš„æ£€ç´¢å™¨å®žçŽ°ã€‚
    """

    def retrieve_documents(
        self, user_query: str, top_k: int, min_similarity: float
    ) -> tuple[List[str], List[float]]:
        """
        è¿”å›ž Mock æ£€ç´¢æ•°æ®ï¼ˆç”¨äºŽæµ‹è¯• RAG æµç¨‹ï¼‰

        Args:
            user_query: ç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬
            top_k: è¿”å›žçš„æœ€å¤§æ–‡æ¡£æ•°é‡
            min_similarity: æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼

        Returns:
            (æ£€ç´¢æ–‡æ¡£åˆ—è¡¨, ç›¸ä¼¼åº¦åˆ†æ•°åˆ—è¡¨)
        """

        assert top_k > 0, "top_k å¿…é¡»å¤§äºŽ0"
        assert 0.0 <= min_similarity <= 1.0, "min_similarity å¿…é¡»åœ¨0.0åˆ°1.0ä¹‹é—´"

        logger.info("ðŸŽ­ [MOCK] ä½¿ç”¨ MockDocumentRetriever æ¨¡æ‹Ÿæ£€ç´¢")
        logger.info(f"ðŸŽ­ [MOCK] æŸ¥è¯¢: {user_query}")

        # æ¨¡æ‹Ÿæ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼ˆæŒ‰ç›¸ä¼¼åº¦é™åºæŽ’åˆ—ï¼‰
        mock_docs = [
            "RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯ä¸€ç§ç»“åˆæ£€ç´¢å’Œç”Ÿæˆçš„AIæŠ€æœ¯ï¼Œé€šè¿‡ä»ŽçŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯æ¥å¢žå¼ºå¤§è¯­è¨€æ¨¡åž‹çš„å›žç­”è´¨é‡ã€‚",
            "RAGç³»ç»Ÿé€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šæ–‡æ¡£æ£€ç´¢å™¨ï¼ˆä½¿ç”¨å‘é‡æ•°æ®åº“å¦‚ChromaDBï¼‰ã€ä¸Šä¸‹æ–‡å¢žå¼ºå™¨å’Œè¯­è¨€æ¨¡åž‹ç”Ÿæˆå™¨ã€‚",
            "ä½¿ç”¨RAGæŠ€æœ¯å¯ä»¥è®©AIæ¨¡åž‹è®¿é—®æœ€æ–°çš„ã€é¢†åŸŸç‰¹å®šçš„çŸ¥è¯†ï¼Œè€Œæ— éœ€é‡æ–°è®­ç»ƒæ¨¡åž‹ï¼Œæ˜¾è‘—æå‡å›žç­”çš„å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§ã€‚",
            "å‘é‡æ•°æ®åº“ï¼ˆå¦‚ChromaDBã€Pineconeï¼‰åœ¨RAGç³»ç»Ÿä¸­æ‰®æ¼”å…³é”®è§’è‰²ï¼Œå®ƒä»¬ä½¿ç”¨åµŒå…¥æ¨¡åž‹å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡å¹¶è¿›è¡Œè¯­ä¹‰æœç´¢ã€‚",
            "LangGraphæ˜¯ä¸€ä¸ªç”¨äºŽæž„å»ºæœ‰çŠ¶æ€ã€å¤šå‚ä¸Žè€…AIåº”ç”¨çš„æ¡†æž¶ï¼Œéžå¸¸é€‚åˆå®žçŽ°å¤æ‚çš„RAGå·¥ä½œæµã€‚",
        ]

        # æ¨¡æ‹Ÿç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆé™åºæŽ’åˆ—ï¼Œæ¨¡æ‹ŸçœŸå®žæ£€ç´¢ç»“æžœï¼‰
        mock_scores = [0.89, 0.76, 0.68, 0.52, 0.41]

        logger.info(f"ðŸŽ­ [MOCK] è¿”å›ž {len(mock_docs)} ä¸ªæ¨¡æ‹Ÿæ–‡æ¡£")
        for i, (doc, score) in enumerate(zip(mock_docs, mock_scores), 1):
            logger.debug(f"ðŸŽ­ [MOCK] [{i}] ç›¸ä¼¼åº¦: {score:.3f}, å†…å®¹: {doc[:50]}...")

        return mock_docs, mock_scores
